name: Publish Website

on:
  push:
    branches:
      - master
    paths:
      - "**.php"
      - "src/**"
      - "dist/**"
      - "assets/**"
      - "template-parts/**"
      - "inc/**"
      - "style.css"
      - "gulpfile.js"
      - "package.json"
      - "yarn.lock"

jobs:
  web-deploy:
    name: ðŸš€ Deploy Website Every Commit
    runs-on: ubuntu-latest

    steps:
      - name: ðŸšš Get Latest Code
        uses: actions/checkout@v3

      - name: ðŸ”§ Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: "20"
          cache: "yarn"

      - name: ðŸ§¶ Use Yarn 4
        run: corepack prepare yarn@4.9.2 --activate

      - name: ðŸ“¦ Ensure Yarn is available
        run: yarn --version

      - name: ðŸ“¥ Install Dependencies
        run: yarn install --immutable

      - name: ðŸ›  Build Assets
        run: yarn gulp build

      - name: ðŸš€ Deploy Theme
        uses: SamKirkland/web-deploy@v1
        with:
          target-server: elideproperty.co.zw
          remote-user: elidepro
          private-ssh-key: ${{ secrets.SSH_KEY }}
          destination-path: /home/elidepro/elideproperty.co.zw/public_html/wp-content/themes/crafted-theme/
          ssh-port: 65002
          source-path: ./
          exclude: |
            **/node_modules/**
            **/.git/**
            **/.github/**
            **/src/**
            **/.editorconfig
            **/.gitignore
            **/package.json
            **/yarn.lock
            **/gulpfile.js
          dangerously-clean-slate: true
